{% extends 'base_restaurateur_page.html' %}

{% block title %}–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã | Star Burger{% endblock %}

{% block content %}
<center>
  <h2>–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
</center>

<hr />
<br />
<div class="container">
  <table class="table table-responsive font-sm">
    <tr>
      <th>ID</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–û–ø–ª–∞—Ç–∞</th>
      <th>–°–æ–∑–¥–∞–Ω</th>
      <th>–ö–ª–∏–µ–Ω—Ç</th>
      <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
      <th>–ê–¥—Ä–µ—Å</th>
      <th>–°—É–º–º–∞</th>
      <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
      <th>–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</th> <!-- –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <th>–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∫—É</th>
    </tr>
    {% for order in orders %}
    <tr class="{% if order.status == 'processing' %}table-warning{% endif %}">

      <td>{{ order.id }}</td>

      <td class="status-cell">
        <span class="badge
          {% if order.status == 'new' %}badge-secondary
          {% elif order.status == 'processing' %}badge-warning
          {% else %}badge-light{% endif %}">
          {{ order.get_status_display }}
        </span>
      </td>

      <td class="payment-method">
        <span class="payment-badge">
          {{ order.get_payment_method_display }}
        </span>
      </td>

      <td>{{ order.created_at|date:"d.m H:i" }}</td>

      <td>{{ order.firstname }} {{ order.lastname }}</td>

      <td>{{ order.phonenumber }}</td>

      <td>{{ order.address }}</td>

      <td class="order-price">{{ order.total_price_calc|default:"0.00" }} ‚ÇΩ</td>

      <td class="order-comment">
        {% if order.comment %}
        <details>
          <summary>üìù –ü–æ–∫–∞–∑–∞—Ç—å</summary>
          <div class="comment-content">{{ order.comment }}</div>
        </details>
        {% else %}
        ‚Äî
        {% endif %}
      </td>

      <td class="restaurant-info">
        {% if order.restaurant %}
        <div class="selected-restaurant">
          ‚úÖ {{ order.restaurant.name }}
          <div class="text-muted small">{{ order.restaurant.address }}</div>
        </div>
        {% else %}
        <details class="restaurants-dropdown">
          <summary>
            <span class="badge badge-warning">
              üè™ –í—ã–±—Ä–∞—Ç—å ({{ order.available_restaurants|length }})
            </span>
          </summary>
          <div class="restaurant-list">
            {% for restaurant in order.available_restaurants %}
            <div class="restaurant-item">
              {{ restaurant.name }}
              <div class="text-muted small">{{ restaurant.address }}</div>
              <a
                href="{% url 'admin:foodcartapp_order_change' order.id %}?restaurant={{ restaurant.id }}&next={{ request.get_full_path|urlencode }}"
                class="btn btn-sm btn-link py-0">
                –í—ã–±—Ä–∞—Ç—å
              </a>
            </div>
            {% if not forloop.last %}<hr>{% endif %}
            {% empty %}
            <div class="text-danger small">
              ‚ö† –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
            </div>
            {% endfor %}
          </div>
        </details>
        {% endif %}
      </td>

      <td>
        <a
          href="{% url 'admin:foodcartapp_order_change' order.id %}?next={{ request.get_full_path|urlencode }}"
          class="edit-btn">
          ‚úé –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="11" class="empty-msg">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤</td>
    </tr>
    {% endfor %}
  </table>
</div>

<style>
  .font-sm { font-size: 0.9rem; }
  .payment-method { min-width: 140px; }
  .payment-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    background: #e3f2fd;
    color: #1976d2;
  }
  .status-cell { font-weight: 500; }
  .order-price {
    font-weight: 600;
    color: #2e7d32;
    white-space: nowrap;
  }
  .comment-content {
    background: #f8f9fa;
    padding: 8px;
    border-radius: 4px;
    margin-top: 4px;
  }
  .edit-btn {
    color: #3b82f6;
    text-decoration: none;
    padding: 2px 6px;
    border-radius: 4px;
    transition: background 0.2s;
  }
  .edit-btn:hover { background: #e8f4ff; }
  .empty-msg {
    color: #757575;
    text-align: center;
    padding: 20px !important;
  }
  th {
    background: #f5f5f5;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  .restaurant-info { min-width: 250px; }
  .restaurant-list {
    max-height: 200px;
    overflow-y: auto;
    padding: 8px;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    margin-top: 5px;
  }
  .restaurant-item {
    padding: 5px 0;
  }
  .selected-restaurant {
    background: #dff0d8;
    padding: 6px;
    border-radius: 4px;
  }
  .badge-restaurant {
    background-color: #c3e6cb;
    color: #155724;
  }
  .badge-warning { background: #fff3cd; color: #856404; }
</style>
{% endblock %}
